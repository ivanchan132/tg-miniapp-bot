<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Mini App</title>
  <!-- –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π viewport: –∑–∞–ø—Ä–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∂–µ—Å—Ç–∞–º–∏ –Ω–∞ iOS -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <style>
    :root { --safe-bottom: env(safe-area-inset-bottom, 0px); }

    /* –≥–ª–æ–±–∞–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ/–ø–æ–¥—Å–≤–µ—Ç–∫—É –∏ –¥–≤–æ–π–Ω–æ–π-—Ç–∞–ø-–∑—É–º */
    html, body {
      margin: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      -webkit-user-select: none; user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation; /* –æ—Ç–∫–ª—é—á–∞–µ—Ç double-tap zoom –≤ iOS Safari */
      background: #f0f0f0;
      display: flex; flex-direction: column; align-items: center;
    }

    section {
      display: none;
      width: 100%;
      max-width: 500px;
      flex: 1;
      padding: 20px 20px calc(20px + var(--safe-bottom));
      text-align: center;
      overflow-y: auto;
      padding-bottom: 80px;
      box-sizing: border-box;
    }
    section.active { display: block; }

    /* –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é —Å —É—á—ë—Ç–æ–º safe-area */
    nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      display: flex; justify-content: space-around;
      background: #ffe0b2;
      padding: 10px 10px calc(10px + var(--safe-bottom));
      border-top: 2px solid #ff9800;
      z-index: 10;
      box-sizing: border-box;
    }
    nav button {
      flex: 1; margin: 0 6px; padding: 12px;
      font-size: 20px; border-radius: 12px;
      border: none; background: #ffcc80; cursor: pointer;
    }
    nav button.active { background: #ffb74d; }

    /* —Å—Ü–µ–Ω–∞ —Å –∫–∞–Ω–≤–∞—Å–æ–º */
    #stage {
      position: relative;
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      -webkit-user-select: none; user-select: none;
    }
    canvas {
      display: block;
      width: 100%;
      height: auto;
      background: linear-gradient(to bottom, #87ceeb, #fff);
      border: 2px solid #333;
      border-radius: 10px;
      margin: 0 auto;
      touch-action: none;   /* –∑–∞–ø—Ä–µ—Ç pinch/–ø–∞–Ω/–¥–≤–æ–π–Ω–æ–≥–æ —Ç–∞–ø–∞ –Ω–∞ —Å–∞–º–æ–º –∫–∞–Ω–≤–∞—Å–µ */
      outline: none;
    }

    #score { font-size: 22px; margin: 10px; }

    /* –û–≤–µ—Ä–ª–µ–π —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–Ω–æ–ø–∫–æ–π –Ω–∞–¥ –∫–∞–Ω–≤–∞—Å–æ–º */
    #gameOverBox {
      display: none;
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      pointer-events: none; /* –∫–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –∫ –∫–Ω–æ–ø–∫–µ */
      -webkit-user-select: none; user-select: none;
    }
    #gameOverText {
      font-size: 28px;
      color: yellow;
      margin-bottom: 15px;
      line-height: 1.4;
      text-shadow: 0 2px 2px rgba(0,0,0,.3);
    }
    /* –ö–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ */
    #restartBtn {
      background: #ffeb3b;
      color: black;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      pointer-events: auto; /* –∫–Ω–æ–ø–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ */
    }
  </style>
</head>
<body>

  <!-- –ò–≥—Ä–∞ -->
  <section id="game" class="active">
    <div id="score">–û—á–∫–∏: 0</div>
    <div id="stage">
      <canvas id="gameCanvas"></canvas>

      <!-- –û–≤–µ—Ä–ª–µ–π –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∏–≥—Ä—ã: —Ç–µ–∫—Å—Ç + –∫–Ω–æ–ø–∫–∞ "–ó–∞–Ω–æ–≤–æ" -->
      <div id="gameOverBox">
        <div id="gameOverText">–û—Ç–ª–∏—á–Ω–æ! <br> –ü–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë?</div>
        <button id="restartBtn" onclick="restartGame()">–ó–∞–Ω–æ–≤–æ</button>
      </div>
    </div>
  </section>

  <!-- –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ -->
  <section id="congrats">
    <h2>–ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Ç–µ–±—è —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º üéâ</h2>
    <p>–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è!ü•≥
–ñ–µ–ª–∞—é —Ç–µ–±–µ –ª—ë–≥–∫–æ—Å—Ç–∏ –≤ –¥—É—à–µ, –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è.–ü—É—Å—Ç—å –∂–∏–∑–Ω—å —Ä–∞–¥—É–µ—Ç —Ç–µ–±—è –º–µ–ª–æ—á–∞–º–∏ ‚Äî –∫—Ä–∞—Å–∏–≤—ã–º –Ω–µ–±–æ–º, –∏—Å–∫—Ä–µ–Ω–Ω–∏–º–∏ —É–ª—ã–±–∫–∞–º–∏ –∏ —É—é—Ç–Ω—ã–º–∏ –≤–µ—á–µ—Ä–∞–º–∏. –ü—É—Å—Ç—å –±–æ–ª—å—à–∏–µ –º–µ—á—Ç—ã —Ç–æ–∂–µ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤–æ–ø–ª–æ—â–∞—é—Ç—Å—è –≤ –∂–∏–∑–Ω—å. –•–æ—á—É, —á—Ç–æ–±—ã —Å—á–∞—Å—Ç—å–µ –±—ã–ª–æ —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å: —Å —É—Ç—Ä–∞, –∫–æ–≥–¥–∞ —Ç—ã –ø—Ä–æ—Å—ã–ø–∞–µ—à—å—Å—è, –∏ –≤–µ—á–µ—Ä–æ–º, –∫–æ–≥–¥–∞ –∑–∞—Å—ã–ø–∞–µ—à—å, –≤ –∫–∞–∂–¥–æ–º –º–æ–º–µ–Ω—Ç–µ –¥–Ω—è —Ç—ã —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–µ–±—è —Å—á–∞—Å—Ç–ª–∏–≤–æ–π. –ß—Ç–æ –±—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—ã–ª –Ω–∞–ø–æ–ª–Ω–µ–Ω —ç–º–æ—Ü–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞–≤–ª—è—é—Ç —Å–ª–µ–¥, –≤—Å—Ç—Ä–µ—á–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–≥—Ä–µ–≤–∞—é—Ç, –∏ –º–æ–º–µ–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–∞–º—è—Ç–∏. –°–∏–ª –∏ —Å–º–µ–ª–æ—Å—Ç–∏ –∏–¥—Ç–∏ —Ç—É–¥–∞, –≥–¥–µ –∑–æ–≤–µ—Ç –¥—É—à–∞, –∏ –º—É–¥—Ä–æ—Å—Ç–∏ —á—Ç–æ –±—ã –Ω–µ —Å–±–∏—Ç—å—Å—è —Å –ø—É—Ç–∏. –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–Ω—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–±–µ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ —Ä–∞–¥–æ—Å—Ç–∏ –∏ —Å–≤–µ—Ç–∞.
–ü—É—Å—Ç—å —Ä—è–¥–æ–º –±—É–¥—É—Ç –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ü–µ–Ω—è—Ç —Ç–µ–±—è –∏ –Ω–∞–ø–æ–ª–Ω—è—é—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å —Ç–µ–ø–ª–æ–º. –ò –ø—É—Å—Ç—å —É —Ç–µ–±—è –±—É–¥–µ—Ç —Ç—ã—Å—è—á–∞ –ø–æ–≤–æ–¥–æ–≤ —É–ª—ã–±–Ω—É—Ç—å—Å—è –¥–∞–∂–µ –≤ —Å–∞–º—ã–µ –æ–±—ã—á–Ω—ã–µ –¥–Ω–∏. –¢—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å –º–∏—Ä –≤–æ–∫—Ä—É–≥ —Å–µ–±—è —Å–≤–µ—Ç–ª–µ–µ ‚Äî –ø—É—Å—Ç—å –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–µ–±–µ –≤–∑–∞–∏–º–Ω–æ—Å—Ç—å—é.‚ù§Ô∏è

 ‚Ä®–≠—Ç–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–∏—Å–∞—Ç—å –µ—â–µ –æ—á–µ–Ω—å –¥–æ–ª–≥–æ, –ø–µ—Ä–µ–≤–æ–¥—è –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã, –Ω–æ —è –ø–æ—Å—Ç–∞—Ä–∞–ª—Å—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å—Å—è –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏ , —á—Ç–æ –±—ã –Ω–µ –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å —Ç–µ–±—è –≥—Ä—É—Å—Ç–∏—Ç—å –∏ –≥–æ–Ω—è—Ç—å –ª–∏—à–Ω–∏–µ –º—ã—Å–ª–∏ –≤ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—èü§ó
–ù—É –∞ –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –∏ –≤–∑–≥—Ä—É—Å—Ç–Ω—É–ª–æ—Å—å, —Ç–æ –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ª—ã–±–Ω—É—Ç—å—Å—è üòä‚Ä®‚Ä®–¢–∞–∫ –∫–∞–∫ —è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö –ø–æ–¥–∞—Ä–∫–∞, –Ω–∏—á–µ–≥–æ –¥—Ä—É–≥–æ–≥–æ –∫—Ä–æ–º–µ –∫–∞–∫ —Ü–∏—Ñ—Ä–æ–≤—ã–µ  –Ω–µ –æ—Å—Ç–∞–µ—Ç—Å—è) –ü–æ—ç—Ç–æ–º—É –≤ –º–æ–º–µ–Ω—Ç—ã —É—Å—Ç–∞–ª–æ—Å—Ç–∏ —Ç–µ–ª–∞ –∏–ª–∏ –¥—É—à–µ–≤–Ω–æ–π –æ–±–µ—Å–ø–æ–∫–æ–µ–Ω–Ω–æ—Å—Ç–∏  –ø—Ä–µ–¥–ª–∞–≥–∞—é –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–¥–Ω–∏–º –∏–∑ –ø–æ–¥–∞—Ä–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–µ.</p>
  </section>

  <!-- –ü–æ–¥–∞—Ä–æ–∫ -->
<section id="gift">
  <h2>Gift üéÅ</h2>
  <p>–•–º–º, —Ç—É—Ç –Ω—É–∂–µ–Ω –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–π —Å –Ω–∞—à–µ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—Å—Ç—Ä–µ—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–µ —á–∏—Å–ª–æ:</p>
  <input type="password" id="giftPass" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
  <button onclick="checkPassword()">–û—Ç–∫—Ä—ã—Ç—å</button>
  <div id="giftContent" style="display:none;">
    <img src="https://i.postimg.cc/1RpxwY9Y/cert-65945-1874-page-0001.jpg" alt="–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç 1" style="max-width:100%; cursor:pointer; margin:10px 0;" onclick="openModal(this.src)">
    <img src="https://i.postimg.cc/v8vqQR8M/image.jpg" alt="–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç 2" style="max-width:100%; cursor:pointer; margin:10px 0;" onclick="openModal(this.src)">
  </div>
</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="imgModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); text-align:center; z-index:999;">
  <span style="position:absolute; top:20px; right:30px; font-size:40px; color:white; cursor:pointer;" onclick="closeModal()">&times;</span>
  <img id="modalImg" src="" style="max-width:90%; max-height:90%; margin-top:40px; border-radius:10px;">
</div>

<script>
function openModal(src) {
  document.getElementById("imgModal").style.display = "block";
  document.getElementById("modalImg").src = src;
}
function closeModal() {
  document.getElementById("imgModal").style.display = "none";
}
</script>


  <!-- –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å -->
  <section id="feedback">
    <h2>–¢—É—Ç –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Çüòå</h2>
    <input type="text" placeholder="–≠—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç">
    <textarea rows="4" placeholder="–ò —ç—Ç–æ —Ç–æ–∂–µ"></textarea>
    <button>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </section>

  <!-- –ú–µ–Ω—é -->
  <nav>
    <button class="active" onclick="showSection('game')">üéÆ</button>
    <button onclick="showSection('congrats')">üíå</button>
    <button onclick="showSection('gift')">üéÅ</button>
    <button onclick="showSection('feedback')">‚úçÔ∏è</button>
  </nav>

  <script>
    /* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π */
    function showSection(id) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');
      if (id === 'game') resizeCanvas();
    }

    /* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –∫ –ø–æ–¥–∞—Ä–∫—É */
    function checkPassword() {
      const pass = document.getElementById('giftPass').value;
      if (pass === "2016") {
        document.getElementById('giftContent').style.display = 'block';
      } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
      }
    }

    // --------- –ó–ê–ü–†–ï–¢ –ñ–ï–°–¢–û–í –ó–£–ú–ê/–í–´–î–ï–õ–ï–ù–ò–Ø (iOS) ---------
    document.addEventListener('gesturestart',  e => e.preventDefault());
    document.addEventListener('gesturechange', e => e.preventDefault());
    document.addEventListener('dblclick',      e => e.preventDefault());
    document.addEventListener('selectstart',   e => e.preventDefault());

    // --------- –ê–î–ê–ü–¢–ò–í –ò–ì–†–´ ---------
    const stage   = document.getElementById('stage');
    const canvas  = document.getElementById('gameCanvas');
    const ctx     = canvas.getContext('2d');
    const overBox = document.getElementById('gameOverBox');
    const overText= document.getElementById('gameOverText');

    // –ë–∞–∑–æ–≤–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 2:3 (–∫–∞–∫ 400x600)
    const RATIO = 3/2;
    let VIEW_W = 400; // –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã (–≤ CSS-–ø–∏–∫—Å–µ–ª—è—Ö)
    let VIEW_H = 600;

    function resizeCanvas() {
      const containerW = stage.clientWidth;
      const nav = document.querySelector('nav');
      const safeBottom = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--safe-bottom')) || 0;
      const availableH = window.innerHeight - nav.offsetHeight - 40 - safeBottom;

      let targetW = containerW;
      let targetH = Math.min(targetW * RATIO, availableH);
      if (targetH < targetW * RATIO) {
        targetW = Math.min(containerW, availableH / RATIO);
        targetH = targetW * RATIO;
      }

      VIEW_W = Math.max(280, Math.floor(targetW));
      VIEW_H = Math.floor(targetH);

      const dpr = Math.min(window.devicePixelRatio || 1, 2); // –æ–≥—Ä–∞–Ω–∏—á–∏–º –¥–æ 2—Ö
      canvas.style.width  = VIEW_W + 'px';
      canvas.style.height = VIEW_H + 'px';
      canvas.width  = Math.round(VIEW_W * dpr);
      canvas.height = Math.round(VIEW_H * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    // --------- –ò–ì–†–ê ---------
    let bird, pipes, frame, score, gameOver;
    let clouds = [];

    /* –û–±–ª–∞–∫–∞ –ø–æ–¥ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã */
    function initClouds() {
      clouds = Array.from({ length: 6 }, () => ({
        x: Math.random() * VIEW_W,
        y: Math.random() * (VIEW_H * 0.4) + 20,
        r: 20 + Math.random() * 25,
        speed: 0.2 + Math.random() * 0.4
      }));
    }
    function updateClouds() {
      clouds.forEach(c => {
        c.x -= c.speed;
        if (c.x < -c.r * 3) {
          c.x = VIEW_W + c.r * 3;
          c.y = Math.random() * (VIEW_H * 0.4) + 20;
          c.r = 20 + Math.random() * 25;
          c.speed = 0.2 + Math.random() * 0.4;
        }
      });
    }
    function drawClouds() {
      ctx.save();
      ctx.globalAlpha = 0.85;
      ctx.fillStyle = "#ffffff";
      clouds.forEach(c => {
        ctx.beginPath();
        ctx.ellipse(c.x, c.y, c.r, c.r * 0.6, 0, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.restore();
    }

    function initGame() {
      bird = { x: Math.floor(VIEW_W * 0.125), y: Math.floor(VIEW_H * 0.25),
               width: 30, height: 30, gravity: 0.6, lift: -8, velocity: 0 };
      pipes = [];
      frame = 0;
      score = 0;
      gameOver = false;
      document.getElementById("score").innerText = "–û—á–∫–∏: 0";
      overBox.style.display = "none";
      initClouds();
    }

    function drawBird() {
  ctx.save();
  ctx.font = `${bird.height}px Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, Arial`;
  ctx.textAlign = 'left';
  ctx.textBaseline = 'alphabetic';
  ctx.fillStyle = '#000000';      // —Å–±—Ä–æ—Å —Ü–≤–µ—Ç–∞, —á—Ç–æ–±—ã —ç–º–æ–¥–∂–∏ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –∂—ë–ª—Ç—ã–º
  ctx.fillText("üíõ", bird.x - Math.floor(bird.width/2), bird.y + Math.floor(bird.height/3));
  ctx.restore();
}
    function updateBird() {
      bird.velocity += bird.gravity;
      bird.y += bird.velocity;
      if (bird.y + bird.height / 2 >= VIEW_H) gameOver = true;
      if (bird.y - bird.height / 2 <= 0) {
        bird.y = bird.height / 2; bird.velocity = 0;
      }
    }

    // --- –∫—Ä–∞—Å–∏–≤—ã–µ —Ç—Ä—É–±—ã ---
    function roundedRect(ctx, x, y, w, h, r) {
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x + rr, y);
      ctx.arcTo(x + w, y,     x + w, y + rr, rr);
      ctx.arcTo(x + w, y + h, x + w - rr, y + h, rr);
      ctx.arcTo(x,     y + h, x,     y + h - rr, rr);
      ctx.arcTo(x,     y,     x + rr, y, rr);
      ctx.closePath();
    }
    function makePipeGradient(y, y2) {
      const g = ctx.createLinearGradient(0, y, 0, y2);
      g.addColorStop(0,   '#4caf50');
      g.addColorStop(0.5, '#66bb6a');
      g.addColorStop(1,   '#388e3c');
      return g;
    }
    function drawHighlight(x, y, h) {
      ctx.save(); ctx.globalAlpha = 0.25; ctx.fillStyle = '#ffffff';
      ctx.fillRect(x + 6, y + 8, 6, h - 16); ctx.restore();
    }
    function drawCap(x, y, w, h) {
      const r = 8;
      const grad = ctx.createLinearGradient(0, y, 0, y + h);
      grad.addColorStop(0, '#2e7d32'); grad.addColorStop(1, '#1b5e20');
      ctx.fillStyle = grad; roundedRect(ctx, x - 6, y, w + 12, h, r); ctx.fill();
      ctx.save(); ctx.globalAlpha = 0.35; ctx.fillStyle = '#ffffff';
      roundedRect(ctx, x - 4, y + 3, w + 8, 4, 2); ctx.fill(); ctx.restore();
      ctx.strokeStyle = '#1b5e20'; ctx.lineWidth = 2;
      roundedRect(ctx, x - 6, y, w + 12, h, r); ctx.stroke();
    }
    function drawPipeBody(x, y, w, h, radius = 10) {
      const grad = makePipeGradient(y, y + h);
      ctx.save(); ctx.fillStyle = 'rgba(0,0,0,0.15)';
      roundedRect(ctx, x + 3, y + 3, w, h, radius); ctx.fill(); ctx.restore();
      ctx.fillStyle = grad; roundedRect(ctx, x, y, w, h, radius); ctx.fill();
      drawHighlight(x, y, h);
      ctx.strokeStyle = '#1b5e20'; ctx.lineWidth = 2;
      roundedRect(ctx, x, y, w, h, radius); ctx.stroke();
    }

    let pipeWidth = 50;
    function drawPipes() {
      const lipH = 16;
      const radius = 10;
      pipes.forEach(pipe => {
        const x = pipe.x, w = pipe.width;
        // –≤–µ—Ä—Ö
        drawPipeBody(x, 0, w, pipe.top, radius);
        drawCap(x, pipe.top - lipH, w, lipH);
        // –Ω–∏–∑
        const bottomY = VIEW_H - pipe.bottom;
        drawCap(x, bottomY, w, lipH);
        drawPipeBody(x, bottomY + lipH, w, pipe.bottom - lipH, radius);
      });
    }

    function updatePipes() {
      const spawnEvery = 140;                        // –∫–∞–¥—Ä—ã –¥–æ –Ω–æ–≤–æ–π –ø–∞—Ä—ã
      const pipeSpeed  = Math.max(2, Math.round(VIEW_W / 200));
      pipeWidth = Math.max(40, Math.round(VIEW_W * 0.12));

      if (frame % spawnEvery === 0) {
        const top = Math.random() * (VIEW_H / 2);
        const gap = 150;                             // –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∑–∞–∑–æ—Ä
        const bottom = VIEW_H - top - gap;
        pipes.push({ x: VIEW_W, width: pipeWidth, top, bottom, passed:false });
      }

      pipes.forEach(pipe => {
        pipe.x -= pipeSpeed;

        // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ
        if (
          bird.x + bird.width / 2 > pipe.x &&
          bird.x - bird.width / 2 < pipe.x + pipe.width &&
          (bird.y - bird.height / 2 < pipe.top ||
           bird.y + bird.height / 2 > VIEW_H - pipe.bottom)
        ) gameOver = true;

        // –æ—á–∫–∏: –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏
        if (!pipe.passed && pipe.x + pipe.width < bird.x - bird.width/2) {
          pipe.passed = true;
          score++; document.getElementById("score").innerText = "–û—á–∫–∏: " + score;
        }
      });

      pipes = pipes.filter(pipe => pipe.x + pipe.width > 0);
    }

    function draw() {
      ctx.clearRect(0, 0, VIEW_W, VIEW_H);
      drawClouds();
      drawPipes();
      drawBird();
    }
    function update() { updateClouds(); updateBird(); updatePipes(); }

    function loop() {
      if (gameOver) {
        // —Ç–≤–æ–∏ —Ç–µ–∫—Å—Ç—ã –ø–æ —Å—á–µ—Ç—É
        if (score === 9) {
  overText.innerHTML = "<span style='color:#ff69b4'>–¢—ã –Ω–∞–ø–æ–ª–Ω—è–µ—à—å —Ç–∏—à–∏–Ω—É —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ–º –∏ —Å–≤–µ—Ç–æ–º</span>";
} else if (score === 17) {
  overText.innerHTML = "<span style='color:#ff69b4'>–í —Ç–≤–æ–∏—Ö —É–ª—ã–±–∫–∞—Ö —Å–≤–µ—Ç —Ä–∞—Å—Å–≤–µ—Ç–∞</span>";
} else if (score === 21) {
  overText.innerHTML = "<span style='color:#ff69b4'>–¢—ã —É–∫—Ä–∞—à–∞–µ—à—å —Å–æ–±–æ–π –≤–µ—Å—å –º–∏—Ä</span>";
} else if (score === 32) {
  overText.innerHTML = "<span style='color:#ff69b4'>–¢—ã –ø—Ä–∏–¥–∞—ë—à—å –º–æ–º–µ–Ω—Ç–∞–º –æ—Å–æ–±—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å</span>";
} else {
  overText.innerHTML = "–û—Ç–ª–∏—á–Ω–æ! <br> –ü–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë?";
}
        overBox.style.display = "block";
        return;
      }
      update(); draw();
      frame++;
      requestAnimationFrame(loop);
    }

    function restartGame() { initGame(); loop(); }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —É–±–∏—Ä–∞–µ–º –¥–≤–æ–π–Ω—ã–µ —Ç–∞–ø—ã ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º pointerdown –≤–º–µ—Å—Ç–æ click/touchstart
    document.addEventListener("keydown", () => {
      if (!gameOver) bird.velocity = bird.lift;
    }, { passive: true });

    document.addEventListener("pointerdown", () => {
      if (!gameOver) bird.velocity = bird.lift;
    }, { passive: true });

    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è + —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤/–ø–æ–≤–æ—Ä–æ—Ç
    function start() { resizeCanvas(); initGame(); loop(); }
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('orientationchange', () => setTimeout(resizeCanvas, 300));

    start();
  </script>
</body>
</html>
